<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">

<!-- ====================================
    ——— MODAL SECTION
    ===================================== -->
    <th:block  th:fragment="modalFragment">
		   <h1 th:text="${title}"></h1>
		   <!-- Signup Modal:아이디 찾기 -->
		   <div class="modal fade" id="findId" tabindex="-1"  role="dialog" aria-label="signupModalLabel" aria-hidden="true">
		     <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
		       <div class="modal-content">
		         <div class="modal-header rounded">
		           <h3 class="modal-title text-uppercase font-weight-bold">아이디 찾기</h3>
		           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		         </div>
		
		         <div class="modal-body">
		           <form class="" action="index.html" method="post">
		             <div class="mb-3">
		               <input type="text" class="form-control bg-smoke" required="" placeholder="사용자 이름">
		             </div>
		   
		             <div class="mb-3">
		               <input type="email" class="form-control bg-smoke" required="" placeholder="둥록된 이메일">
		             </div>
		   
		             <div class="mb-3">
		               <input type="password" class="form-control bg-smoke" required="" placeholder="인증번호">
		             </div>
		   
		   		  <div class="modal-body-certified-msg">
		   		  	<a>인증이 완료되었습니다.</a>
		   		  </div>
		             
		
		             <div class="d-grid">
		               <button type="submit" class="btn btn-primary text-uppercase">확인</button>
		             </div>
		           </form>
		         </div>
		  		 <div class="mb-3 form-check mb-0">
		               <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#findPw">비밀번호 찾기</a>
		               <a>	|	</a>
		               <a href="/member/member_login_terms_mem">회원가입</a>
		        </div>
		       </div>
		     </div>
		   </div>
		
		<!-- Signup Modal:비밀번호 찾기 -->
		   <div class="modal fade" id="findPw" tabindex="-1" role="dialog" aria-label="signupModalLabel" aria-hidden="true">
		     <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
		       <div class="modal-content">
		         <div class="modal-header rounded">
		           <h3 class="modal-title text-uppercase font-weight-bold">비밀번호 찾기</h3>
		           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		         </div>
		
		         <div class="modal-body">
		           <form class="" action="index.html" method="post">
		             <div class="mb-3">
		               <input type="text" class="form-control bg-smoke" required="" placeholder="사용자 아이디">
		             </div>
		   
		             <div class="mb-3">
		               <input type="email" class="form-control bg-smoke" required="" placeholder="둥록된 이메일">
		             </div>
		   
		             <div class="mb-3">
		               <input type="password" class="form-control bg-smoke" required="" placeholder="인증번호">
		             </div>
		   
		   		  <div class="modal-body-certified-msg">
		   		  	<a>인증이 완료되었습니다.</a>
		   		  </div>
		             
		
		             <div class="d-grid">
		               <button type="submit" class="btn btn-primary text-uppercase">확인</button>
		             </div>
		           </form>
		         </div>
		  		 <div class="mb-3 form-check mb-0">
		               <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#findId">아이디 찾기</a>
		               <a>	|	</a>
		               <a href="/member/member_login_terms_mem">회원가입</a>
		        </div>
		       </div>
		     </div>
		   </div>
		
		<!-- Signup Modal:비밀번호 변경 -->
		   <div class="modal fade" id="changePw" tabindex="-1" role="dialog" aria-label="signupModalLabel" aria-hidden="true">
		     <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
		       <div class="modal-content">
		         <div class="modal-header rounded">
		           <h3 class="modal-title text-uppercase font-weight-bold">비밀번호 변경</h3>
		           <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		         </div>
		
		         <div class="modal-body">
		           <form class="" action="index.html" method="post">
		             <div class="mb-3">
		               <input type="text" class="form-control bg-smoke" required="" placeholder="변경할 비밀번호">
		             </div>
		   
		             <div class="mb-3">
		               <input type="email" class="form-control bg-smoke" required="" placeholder="비밀번호 확인">
		             </div>
		   		  <div class="modal-body-certified-msg">
		   		  	<a>비밀번호가 일치합니다.</a>
		   		  </div>
		             
		
		             <div class="d-grid">
		               <button type="button" id="pwBtn" class="btn btn-primary text-uppercase">변경</button>
		             </div>
		           </form>
		         </div>
		  		 <div class="mb-3 form-check mb-0">
		               <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#findId">아이디 찾기</a>
		               <a>	|	</a>
		               <a href="/member/member_login_terms_mem">회원가입</a>
		        </div>
		       </div>
		     </div>
		   </div>
		
		
		   <!-- Login Modal:로그인 화면 -->
		<div class="modal fade" id="login" tabindex="-1" role="dialog" aria-label="loginModalLabel" aria-hidden="true">
		    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
		        <div class="modal-content">
		            <div class="modal-header rounded">
		                <h3 class="modal-title text-uppercase font-weight-bold">로그인</h3>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		
		            <div class="modal-body">
		                <form id="loginForm" th:action="@{/member/login}" method="post">
		                 	<input type="hidden" id="currentPage" name="currentPage" th:value="${currentPage}" />
		                    <div class="mb-3">
		                        <input type="text" id="memberId" name="memberId" th:value="${memberId}" class="form-control bg-smoke" required="" placeholder="Id">
		                    </div>
		
		                    <div class="mb-3">
		                        <input type="password" id="memberPw" name="memberPw" th:value="${memberPw}" class="form-control bg-smoke" required="" placeholder="Password">
		                    </div>
		
		                    <div class="mb-3 form-check mb-0">
		                        <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#findId">아이디 찾기</a>
		                        <a> | </a>
		                        <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#findPw">비밀번호 찾기</a>
		                        <a> | </a>
		                        <a href="/member/member_login_terms_mem">회원가입</a>
		                    </div>
		
		                    <div class="d-grid">
		                        <button type="button" id="loginBtn" class="btn btn-primary btn-block text-uppercase">로그인</button>
		                    </div>
		                </form>
		            </div>
		        </div>
		    </div>
		</div>
		<script th:src="@{/assets/js/jquery-3.7.1.js}"></script>
	  	<script th:inline="javascript">
			    // 페이지 로드 시 현재 URL 설정
			    document.addEventListener('DOMContentLoaded', function() {
			        var currentPageInput = document.getElementById('currentPage');
			        currentPageInput.value = window.location.href;
			    });
			    /*
			    const alertMsg = [[${alertMsg}]];
			    //alert(msg);
			    if (alertMsg) {
			        alert(alertMsg);
			    }*/
			    
			    $('#loginBtn').click(function() {
			    	let isProcess = true;
			        $('#loginForm input').each(function(idx, element) {
			            const id = element.id;
			            const value = $(element).val().trim();
			
			            if (value === '') {
			                // 값이 비어 있는 경우 required 속성을 추가합니다.
			                $('#' + id).prop('required', true);
			
			                // 해당 필드로 포커스를 이동합니다.
			                $('#' + id).focus();
			
			                isProcess = false;
			                return false; // each 함수 종료
			            } else {
			                // 값이 있는 경우 required 속성을 제거합니다.
			                $('#' + id).prop('required', false);
			            }
			        });
			        if(!isProcess) return ; 
					
			        const memberId = $('#memberId').val().trim();
			        const memberPw = $('#memberPw').val().trim();
			        
			        const request = $.ajax({
			        	url : '/member/login',
			        	method : 'POST',
			        	data : { 'memberId' : memberId, 'memberPw' : memberPw },
			        	dataType : 'json'
			        });
			        request.done(function(isLogin){
			        	if(!isLogin){
			        		$('#memberId').prop('required', true).val('');
			        		$('#memberPw').prop('required', true).val('');
			        		alert('회원의 정보가 일치하지 않습니다.');
			        		$('#memberId').focus();
			        		return ;
			        	}
			        	location.reload();
			        });
			    }); 
		</script>
	</th:block>
</html>