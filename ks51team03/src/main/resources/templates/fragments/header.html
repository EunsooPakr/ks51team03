<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!-- ====================================
  ——— HEADER
  ===================================== -->
<header class="header" id="pageTop" th:fragment="headerFragment">
  <!-- Menuzord-->
 <!-- 미니 상단 고정바 -->
				<div class="container-menu-desktop">
					<!-- Topbar -->
					<div class="top-bar" style="top:0px;">
						<div class="content-topbar flex-sb-m h-full container">
							<div class="left-top-bar">
								<!-- <a href="#">로그인</a> -->
<!-- 								<a th:if="${session.SID == null}" href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#login">로그인</a> -->
<!-- 								<a th:if="${session.SID == null}" th:href="@{/member/login}" data-bs-toggle="modal" data-bs-target="#login">로그인</a> -->
								<a th:if="${session.SID == null}" th:href="@{/member/login}" data-bs-toggle="modal" data-bs-target="#login">로그인</a>
								<a th:unless="${session.SID == null}" th:href="@{/member/logout}">로그아웃</a>
							</div>

							<div class="right-top-bar flex-w h-full">
								<ul class="list-unstyled d-flex align-items-center mb-0">
							          <li class="nav-item dropdown nav-item-left">
							            <a href="#" class="nav-link" id="navbarDropdown" role="button" aria-haspopup="true"
							              aria-expanded="false">
							              <i class="fa fa-bell text-gray-color icon" aria-hidden="true"></i> <span class="badge-pill bg-primary text-white" th:text="${session.SINFOCOUNT}"></span>
							            </a>

										  <div class="dropdown-menu dropdown-menu-end dropdown-left">
											  <ul class="list-unstyled list-group list-group-flush">
												  <li class="">
													  <a href="javascript:void(0)" class="list-group-item rounded-0 border-bottom first-child">
														  <h3 class="text-dark mb-0">알림</h3>
													  </a>
												  </li>

												  <li th:each="inform : ${session.SINFORM}">
													  <a href="javascript:void(0)" class="list-group-item border-bottom border-off-white rounded-0">
														  <div class="d-flex justify-content-between align-items-center">
															  <h5 class="fon-size-15 text-dark">제목: <span th:text="${inform.informValue}"></span></h5>
															  <button class="btn btn-outline-danger btn-small" th:attr="data-ircode=${inform.irCode}">X</button>
														  </div>
														  <h6 class="fon-size-13 text-dark">내용: <span th:text="${inform.informContent}"></span></h6>
														  <small class="text-gray-color">발신자: <span th:text="${inform.sendId}"></span></small>
													  </a>
												  </li>
											  </ul>
										  </div>

									  </li>


							          <li class="nav-item dropdown nav-item-left">
							            <a href="#" class="dropdown-toggle" id="dropdownMemberMenuButton" role="button" aria-haspopup="true"
							              aria-expanded="false">
							              <i class="zmdi zmdi-account"></i>
							            </a>

							            <div class="dropdown-menu dropdown-menu-end dropdown-left">
							              <ul class="list-unstyled list-group list-group-flush" id="dropdownMenuList">
							                <li class="">
							                  <a class="list-group-item rounded-0 border-bottom first-child">
							                    <h5 class="fon-size-15 text-dark">
							                    	<span th:if="${session.SNAME != null}" th:text="${session.SNAME} + '님'"></span>
                        							<span th:if="${session.SNAME == null}">손님</span>
							                    </h5>
							                  </a>
							                </li>

							                <li>
							                  <a href="/member/member_mypage_memberinfo" class="list-group-item border-bottom border-off-white rounded-0">
							                    <h5 class="fon-size-15 text-dark text-capitalize">마이페이지</h5>
							                  </a>
							                </li>

							                <li class="">
							                  <a href="javascript:void(0)" class="list-group-item border-off-white border-bottom-0 rounded-0 last-child">
							                    <h5 class="fon-size-15 text-dark">업체페이지</h5>
							                  </a>
							                </li>
							              </ul>
							            </div>
							          </li>
							        </ul>
							</div>
								<!--아이콘 메뉴-->
								<!-- <div class="wrap-icon-header flex-w flex-r-m">
									<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
										<i class="zmdi zmdi-search"></i>
									</div>
									<div class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti" data-notify="0">
										<i class="zmdi zmdi-favorite-outline"></i>
										<i class="zmdi zmdi-notifications"></i>
									</div>
									<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart" data-notify="2">
									<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
										<i class="zmdi zmdi-shopping-cart"></i>
										<i class="zmdi zmdi-account"></i>
									</div>
								</div> -->
							</div>
						</div>
					</div>
		<!-- 상단 컨테이너 -->
		<div class="container-menu-desktop">
			<!-- 상단 고정 메인 메뉴바 -->
			<div class="wrap-menu-desktop">
				<nav class="limiter-menu-desktop container">

					<!-- 로고 -->
					<a href="/" class="logo">
						<img th:src="@{/assets/img/pal_logo.png}" alt="IMG-LOGO">
					</a>

					<!-- 상단메뉴 -->
					<div class="menu-desktop">
						<!--메인메뉴-->
						<ul class="main-menu">
							<!-- <li class="active-menu"> -->
							<li>
								<a href="index.html">PAL</a>
								<ul class="sub-menu">
									<li><a></a></li>
									<li><a href="index.html">사이트소개</a></li>
									<li><a href="home-02.html">이벤트&정보</a></li>
									<li><a href="home-03.html">고객센터</a></li>
									<li><a></a></li>
								</ul>
							</li>

							<li>
								<a th:href="@{/map/map_main}">지도검색</a>
								<ul class="sub-menu">
									<li><a th:href="@{/company/company_info}">업체정보</a></li>
									<li><a th:href="@{/company/company_question}">업체문의</a></li>
									<li><a th:href="@{/company/company_review}">업체리뷰</a></li>
									<li><a th:href="@{/company/company_staff_setting}">직원관리</a></li>
									<li><a th:href="@{/company/company_staff_signUp}">직원신청</a></li>
									<li><a th:href="@{/company/company_send_alarm}">알림발송</a></li>

								</ul>
							</li>
							<li>
								<a href="shoping-cart.html">커뮤니티</a>
								<ul class="sub-menu">
									<li><a href="/board/board_list_normal?currentPage=1&boardCateValue=자유%20게시글">자유게시판</a></li>
									<li><a href="home-02.html">반려동물게시판</a></li>
									<li><a href="home-03.html">질문게시판</a></li>
									<li><a href="home-03.html">갤러리</a></li>
								</ul>
							</li>

							<li>
								<a th:href="@{#}">이별준비</a>
								<ul class="sub-menu">
									<li><a th:href="@{/funeral/serviceList}">이별업체예약</a></li>
									<li><a th:href="@{/funeral/funeral_confirm_payment}">이별내역조회</a></li>
									<li><a th:href="@{/funeral/funeral_insert_service}">이별 서비스 등록</a></li>
									<li><a th:href="@{/funeral/funeral_regService_List}">등록된 장례 서비스 조회</a></li>
								</ul>
							</li>
						</ul>
					</div>
				</nav>
			</div>
		</div>
	<script th:inline="javascript">
		document.addEventListener('DOMContentLoaded', function() {
			document.getElementById('navbarDropdown').addEventListener('click', function(e) {
				e.preventDefault();
				var sessionName = /*[[${session.SNAME}]]*/ null;
				var dropdownMenu = this.nextElementSibling; // 바로 다음 형제 요소로 드롭다운 메뉴를 선택

				// 로그인한 상태가 아니라면
				if (sessionName == null) {
					alert('로그인 후 이용해 주세요.');
					// 초기화할 때 리스트 숨김 처리
					dropdownMenu.style.display = 'none';
				} else {
					console.log('로그인 사용자: ' + sessionName);
					// 드롭다운 메뉴 토글
					if (dropdownMenu.classList.contains('show')) {
						dropdownMenu.classList.remove('show');
						dropdownMenu.style.display = 'none';
					} else {
						// 다른 열려있는 메뉴 닫기
						document.querySelectorAll('.dropdown-menu.show').forEach(function(openMenu) {
							openMenu.classList.remove('show');
							openMenu.style.display = 'none';
						});
						dropdownMenu.classList.add('show');
						dropdownMenu.style.display = 'block';
					}
				}
			});

			document.getElementById('dropdownMemberMenuButton').addEventListener('click', function(e) {
				e.preventDefault();
				var sessionName = /*[[${session.SNAME}]]*/ null;
				var dropdownMenu = this.nextElementSibling; // 바로 다음 형제 요소로 드롭다운 메뉴를 선택

				// 로그인한 상태가 아니라면
				if (sessionName == null) {
					alert('로그인 후 이용해 주세요.');
					// 초기화할 때 리스트 숨김 처리
					dropdownMenu.style.display = 'none';
				} else {
					console.log('로그인 사용자: ' + sessionName);
					// 드롭다운 메뉴 토글
					if (dropdownMenu.classList.contains('show')) {
						dropdownMenu.classList.remove('show');
						dropdownMenu.style.display = 'none';
					} else {
						// 다른 열려있는 메뉴 닫기
						document.querySelectorAll('.dropdown-menu.show').forEach(function(openMenu) {
							openMenu.classList.remove('show');
							openMenu.style.display = 'none';
						});
						dropdownMenu.classList.add('show');
						dropdownMenu.style.display = 'block';
					}
				}
			});

			// 문서 클릭 시 드롭다운 메뉴 닫기
			document.addEventListener('click', function(e) {
				if (!e.target.closest('.nav-item')) {
					document.querySelectorAll('.dropdown-menu.show').forEach(function(openMenu) {
						openMenu.classList.remove('show');
						openMenu.style.display = 'none';
					});
				}
			});

			document.querySelectorAll('.btn-small').forEach(function(button) {
				button.addEventListener('click', function() {
					var irCode = button.getAttribute('data-ircode');
					disableNotification(button, irCode);
				});
			});
		});

		function disableNotification(button, irCode) {
			console.log("X 버튼 클릭됨, irCode:", irCode); // 디버깅을 위한 로그 추가
			// 서버로 업데이트 요청을 보냅니다.
			fetch('/member/disable/' + irCode, {
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json'
				}
			})
					.then(response => {
						if (response.ok) {
							console.log("알림 비활성화 성공"); // 디버깅을 위한 로그 추가
							// 업데이트가 성공하면 화면에서 알림을 제거합니다.
							var liElement = button.closest('li');
							if (liElement) {
								liElement.style.display = 'none';
							}
							// 알림 수 업데이트
							updateNotificationCount();
						} else {
							alert('알림 비활성화에 실패했습니다.');
						}
					})
					.catch(error => {
						console.error('Error:', error);
						alert('알림 비활성화 중 오류가 발생했습니다.');
					});
		}

		function updateNotificationCount() {
			var notificationCountElement = document.querySelector('#navbarDropdown .badge-pill');
			var currentCount = parseInt(notificationCountElement.textContent, 10);
			if (currentCount > 0) {
				notificationCountElement.textContent = currentCount - 1;
			}
		}

	</script>

</header>
</html>