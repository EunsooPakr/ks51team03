<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default}">
<head>
<link rel="stylesheet" th:href="@{/assets/css/member_custom.css}">
<link rel="stylesheet" th:href="@{/assets/css/ckeditor_contents.css}">

</head>
<!-- ====================================
——— BOARD SECTION
===================================== -->
<th:block layout:fragment="customContent">
	<body>
		<div class="board-body">
			<div class="board_wrap">
				<div class="board_title">
					<strong id="board_title" th:text="${boardTitle}">게시판 이름</strong>
					<p id="board_info" th:text="${boardInfo}">게시판 설명</p>
				</div>
				<div class="board_view_wrap">
					<div class="board_view">
						<div class="title" th:text="${noticeBoard.nboardTitle}"></div>
						<div class="info">
							<dl>
								<dt>번호</dt>
								<dd th:text="${noticeBoard.nboardCode}"></dd>
							</dl>
							<dl>
								<dt>작성자</dt>
								<dd th:text="${noticeBoard.memberId}"></dd>
							</dl>
							<dl>
								<dt>작성일</dt>
								<dd th:text="${noticeBoard.nboardRegistDate}"></dd>
							</dl>
							<dl>
								<dt>조회수</dt>
								<dd th:text="${noticeBoard.nboardView}"></dd>
							</dl>
							<dl>
								<dt>추천수</dt>
								<dd th:text="${noticeBoard.nboardRec}"></dd>
							</dl>
						</div>
						<div class="cont" th:utext="${noticeBoard.nboardContent}">
						</div>
					</div>
					<div class="question-comment-box-list">
						<div th:each="aboard : ${aboardList}" class="question-comment-box-read">
							<div class="aboard-read-box" th:classappend="${aboard.aboardSelected == 1} ? 'seleted-text'">
								<a class="arb-id" th:text="${aboard.memberId}">작성자 </a>
								<a class="ard-date" th:text="'('+${aboard.aboardRegistDate}+')'">등록일 </a>
								<a class="ard-btn" th:if="${aboard.memberId == session.SID}" id="aBoardUpdateBtn" name="aBoardUpdateBtn" th:data-aboardcode="${aboard.aboardCode}">수정</a>
								<a class="ard-btn" th:if="${aboard.memberId == session.SID}" id="aBoardDeleteBtn" name="aBoardDeleteBtn" th:data-aboardcode="${aboard.aboardCode}">삭제</a>
								<a class="ard-btn" th:if="${noticeBoard.memberId == session.SID}" id="aBoardSelectBtn" name="aBoardSelectBtn" th:data-aboardcode="${aboard.aboardCode}">채택</a>
								<textarea th:text=${aboard.aboardContent} readonly="readonly"></textarea>
							</div>
						
						</div>
						<div class="question-comment-box-write" role="form" method="post" th:object="${answerBoard}">
							<a>작성자 | </a>
							<input type="text" id="memberId" name="memberId" th:value="${session.SID}" readonly="readonly">
							<textarea id="QContentArea" name="QContentArea">여기에 답변을 입력해주세요.</textarea>
							<button id="aBoardInsertBtn" name="aBoardInsertBtn">등록</button>
						</div>
					</div>
					<div class="bt_wrap">
						<a th:href="'/board/board_list_question?currentPage=1&boardCateValue='+${boardTitle}" class="on">목록</a>
						<a th:if="${session.SID == noticeBoard.memberId}" th:href="'/board/board_edit_question?nboardCode=' + ${noticeBoard.nboardCode}+'&boardCateValue='+${boardTitle}">수정</a>
						<a th:unless="${session.SID == noticeBoard.memberId}" href="#" id="nBoardRecBtn">추천</a>
					</div>
				</div>
			</div>
		</div>
		
		<script th:inline="javascript">
	    	$(document).ready(function() {
	    		$('#aBoardInsertBtn').click(function(event) {
		            event.preventDefault(); // 기본 동작(링크로 이동) 방지
		          
		            const aboardContent = $('#QContentArea').val(); 
		            
		            $.ajax({
		                type: 'POST', // 또는 'GET'에 따라 변경할 수 있음
		                url: '/board/insertABoard', 
		                data: {
		                	aboardTitle: [[${noticeBoard.nboardTitle}]], // 제목 데이터
		                    aboardContent: aboardContent, // 텍스트 영역 데이터
		                    nboardCode: [[${noticeBoard.nboardCode}]], // 게시물 코드
		                    memberId: [[${session.SID}]] // 사용자 ID
		                },
		                success: function(response) {
		                   
		                    alert('해당 질문에 답변을 등록하였습니다.');
		                    location.reload(); // 페이지 리로드
		                },
		                error: function() {
		                    alert('답변 등록에 실패하였습니다.');
		                }
		            });
		        });
	    		
	    		
	    		
		        $('#nBoardRecBtn').click(function(event) {
		            event.preventDefault(); // 기본 동작(링크로 이동) 방지
		          
		            $.ajax({
		                type: 'POST', // 또는 'GET'에 따라 변경할 수 있음
		                url: '/board/recommend', // 추천 처리를 담당하는 서버의 URL
		                data: {
		                	nboardCode: [[${noticeBoard.nboardCode}]] // 추천 대상 게시물의 코드를 서버로 전달
		                },
		                success: function(response) {
		                    // 추천 성공 시, 추천 버튼을 비활성화하거나 메시지를 표시하는 등의 추가 작업 가능
		                    alert('해당 게시물을 추천하였습니다.');
		                    location.reload(); // 페이지 리로드
		                },
		                error: function() {
		                    alert('추천을 처리하는 중 오류가 발생했습니다.');
		                }
		            });
		        });
		        
		        
		     	// 수정 버튼 클릭 시
		        $(document).on('click', '#aBoardUpdateBtn', function(event) {
		        	event.preventDefault(); // 기본 동작(링크로 이동) 방지
		        	
			        const aboardCode = $(this).data('aboardcode'); // 데이터 속성에서 코드 가져오기
		            const updateContent = prompt("수정할 내용을 입력하세요:"); // 수정할 내용 입력 받기
	
		            if (updateContent) {
		                $.ajax({
		                    type: 'POST',
		                    url: '/board/updateABoard', // 수정 처리를 위한 서버 URL
		                    data: {
		                        aboardCode: aboardCode, // 게시물 코드
		                        aboardContent: updateContent // 수정할 내용
		                    },
		                    success: function(response) {
		                        alert('해당 답변이 수정되었습니다.');
		                        location.reload(); // 페이지 리로드
		                    },
		                    error: function() {
		                        alert('답변 수정에 실패하였습니다.');
		                    }
		                });
		            }
	        	});

		        // 삭제 버튼 클릭 시
		        $(document).on('click', '#aBoardDeleteBtn', function(event) {
		            event.preventDefault(); // 기본 동작 방지
	
		            const aboardCode = $(this).data('aboardcode'); // 데이터 속성에서 코드 가져오기
	
		            if (confirm("해당 답변을 삭제하시겠습니까?")) {
		                $.ajax({
		                    type: 'POST',
		                    url: '/board/deleteABoard', // 삭제 처리를 위한 서버 URL
		                    data: {
		                        aboardCode: aboardCode // 게시물 코드
		                    },
		                    success: function(response) {
		                        alert('해당 답변이 삭제되었습니다.');
		                        location.reload(); // 페이지 리로드
		                    },
		                    error: function() {
		                        alert('답변 삭제에 실패하였습니다.');
		                    }
		                });
		            }
		        });
	
		        // 채택 버튼 클릭 시
		        $(document).on('click', '#aBoardSelectBtn', function(event) {
		            event.preventDefault(); // 기본 동작 방지
	
		            const aboardCode = $(this).data('aboardcode'); // 데이터 속성에서 코드 가져오기
	
		            $.ajax({
		                type: 'POST',
		                url: '/board/selectABoard', // 채택 처리를 위한 서버 URL
		                data: {
		                    aboardCode: aboardCode // 게시물 코드
		                },
		                success: function(response) {
		                    alert('해당 답변이 채택되었습니다.');
		                    location.reload(); // 페이지 리로드
		                },
		                error: function() {
		                    alert('답변 채택에 실패하였습니다.');
		                }
		            });
		        });
		    });
	</script>
	</body>
</th:block>

<!-- 사용자정의 javascript file -->
<th:block layout:fragment="customJsFile">
</th:block>

<!-- 사용자정의 javascript -->
<th:block layout:fragment="customJs">
</th:block>
</html>